



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Dynamic Analysis - Jenkins Pipeline</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#dynamic-analysis" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Jenkins Pipeline" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Jenkins Pipeline
            </span>
            <span class="md-header-nav__topic">
              
                Dynamic Analysis
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Jenkins Pipeline" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Jenkins Pipeline
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../problem_statement/" title="Problem Statement" class="md-nav__link">
      Problem Statement
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../setting_up_vms/" title="Setting Up VMs" class="md-nav__link">
      Setting Up VMs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../setting_up_pipeline/" title="Setting Up Pipeline" class="md-nav__link">
      Setting Up Pipeline
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../static_analysis/" title="Static Analysis" class="md-nav__link">
      Static Analysis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../comparing_sast_tools/" title="Comparing SAST Tools" class="md-nav__link">
      Comparing SAST Tools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../configuring_webhook/" title="Configuring Webhook" class="md-nav__link">
      Configuring Webhook
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../deploying_report/" title="Deploying the Report" class="md-nav__link">
      Deploying the Report
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Dynamic Analysis
      </label>
    
    <a href="./" title="Dynamic Analysis" class="md-nav__link md-nav__link--active">
      Dynamic Analysis
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objective" class="md-nav__link">
    Objective
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dast" class="md-nav__link">
    DAST
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#owasp-zap" class="md-nav__link">
    OWASP ZAP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-owasp-zap-with-docker" class="md-nav__link">
    Configuring OWASP ZAP with Docker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temp-stuff" class="md-nav__link">
    TEMP Stuff
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../code_lint_analysis/" title="Linting Analysis" class="md-nav__link">
      Linting Analysis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../generating_sbom/" title="Generating Service Bill of Materials" class="md-nav__link">
      Generating Service Bill of Materials
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objective" class="md-nav__link">
    Objective
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dast" class="md-nav__link">
    DAST
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#owasp-zap" class="md-nav__link">
    OWASP ZAP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuring-owasp-zap-with-docker" class="md-nav__link">
    Configuring OWASP ZAP with Docker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temp-stuff" class="md-nav__link">
    TEMP Stuff
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="dynamic-analysis">Dynamic Analysis</h1>
<h2 id="objective">Objective</h2>
<p>The aim of this section is to perform DAST for <code>DVNA</code> with <code>OWASP ZAP</code> and generate a report to provide a solution to the 1st point of the problem statement under <code>Task 2</code>.</p>
<h2 id="dast">DAST</h2>
<p>DAST or Dynamic Application Security Testing is a black-box testing technique in which the DAST tool <em>interacts</em> with the application bein tested in its running state to imitate an attacker. Unlike static analysis, in DAST one does not have access to the source code of the application and the tool is completely reliant on the interactivity the application provides. In dyanamic analysis, tools are used to automate attacks on the application ranging from SQL Injection, Input Validation, Cross-Site Scripting, and so forth.</p>
<h2 id="owasp-zap">OWASP ZAP</h2>
<p>ZAP or Zed Attack Proxy is an open-source tool used to perform dynamic application security testing designed specifically for web applications. ZAP has a desktop interface, APIs for it to be used in an automated fashion and also a CLI. It imitates an actual user where it interacts with the application to perform various attacks. ZAP comes with a plethora of options to use, for which further details can be found <a href="https://www.zaproxy.org/getting-started/">here</a>. ZAP also comes as a <a href="https://docs.docker.com/">Docker</a> image which is more convenient to use specially if one is using the CLI interface.</p>
<p>Docker is a tool designed to provide ease in shipping applications across platforms. It packages the application, along with all it's dependencies and other required libraries into an <em>image</em>. Then <em>containers</em> (running instances of the image) can be used to run the application on any machine. It is similar to a virtual machine but it differs greatly from them based on the fact that it does not require a full-fledged operating system to run the application. Instead, it runs the application on the system's kernel itself by just bringing along the required libraries with it which could be missing on machines other than the one the application was built on. Further information on docker can be found in the <a href="https://docs.docker.com/">official documentation</a>.</p>
<h2 id="configuring-owasp-zap-with-docker">Configuring OWASP ZAP with Docker</h2>
<p>There's not really any configuration required to run ZAP with Docker other than pulling the image from <a href="https://hub.docker.com">Docker Hub</a>. I used this <a href="https://blog.mozilla.org/fxtesteng/2016/05/11/docker-owasp-zap-part-one/">documentation</a> from Mozilla as it had a lot of errors demonstrated along with their rectification steps for starting out with ZAP. This was missing from all other sources I found.</p>
<ul>
<li>To start off with ZAP, I needed to pull its docker image which I did by running:</li>
</ul>
<pre><code class="docker">docker pull owasp/zap2docker-stable
</code></pre>

<ul>
<li>Then I tried to run the tool with its CLI interface as such:</li>
</ul>
<pre><code class="docker">docker run -e LC_ALL=C.UTF-8 -e LANG=C.UTF-8 -i owasp/zap2docker-stable zap-cli --help
</code></pre>

<p><strong>Note</strong>: Due to an encoding inconsistency between Python2 and Python3, I had to set some environment variables, which can be seen in the above command, to explicitly mention the encoding to be used as ZAP failed to start otherwise.</p>
<ul>
<li>Next I ran a <code>quick-scan</code> to have a look at how ZAP outputs information:</li>
</ul>
<pre><code class="docker">docker run -e LC_ALL=C.UTF-8 -e LANG=C.UTF-8 -i owasp/zap2docker-stable zap-cli quick-scan --start-options '-config api.disablekey=true' --self-contained --spider -l Low http://172.17.0.1:9090
</code></pre>

<p><strong>Note</strong>: Since ZAP is running inside a Docker container, we can not use <code>localhost</code> or <code>127.0.0.1</code> as then the container would take it to be it's own host. So, to overcome this issue we use the IP assigned to <code>docker0</code>, the network interface created for Docker. This IP can be found with this one-liner: <code>$(ip -f inet -o addr show docker0 | awk '{print $4}' | cut -d '/' -f 1)</code>.</p>
<p><strong>Note</strong>: As ZAP also has an API that can be used to interact with it programmatically, I had to use <code>--start-options '-config api.disablekey=true'</code> as otherwise ZAP tried (and failed) to connect to the proxy as the API key was not specified. Also, the <code>-l</code> option specifies the severity level at which ZAP should log a vulnerability to console (or to a report).</p>
<ul>
<li>Now, I tried the <code>active-scan</code> option. For this I first needed to start the <em>daemon</em> for zap to be accessed by the CLI and then run the scan against DVNA. This step was not required previously as while running a <code>quick-scan</code>, the daemon is automatically started to run the scan and stopped after the scan is finished. To do run the daemon with Docker, I ran the following command (with the <code>-u zap</code> segment to execute things with the <code>zap</code> user instead of Docker's default <code>root</code> user):</li>
</ul>
<pre><code class="docker">docker run --rm -e LC_ALL=C.UTF-8 -e LANG=C.UTF-8 --name zap -u zap -p 8090:8080 -d owasp/zap2docker-stable zap.sh -daemon -port 8080 -host 0.0.0.0 -config api.disablekey=true
docker exec &lt;CONTAINER NAME/ID&gt; zap-cli open-url &lt;TARGET URL&gt;
docker exec &lt;CONTAINER NAME/ID&gt; zap-cli active-scan &lt;TARGET URL&gt;
</code></pre>

<p><strong>Note</strong>: Before a scan be be run, I had to run <code>open-url</code> to add the target URL to the configuration in ZAP-CLI, without this, <code>active-scan</code> option will not start a scan on the target.</p>
<p><strong>Note</strong>: When I ran the scan initially, it dropped an error from Python saying that the 'Connection was Refused' while sending requests to the target through the ZAP proxy. It turned out to be an issue with the command written in the blog that I was following. It exposed the wrong port and hence rectifying the port options in the command to <code>-p 8090:8080</code> and <code>-port 8080</code> solved the issue and the scan worked. Another thing is that I chose <code>8090</code> for the host port as I already had Jenkins running on <code>8080</code>. Lastly, I also appended the <code>--rm</code> flag to delete the container when I stop it.</p>
<ul>
<li>Now to be able to scan DVNA from the CLI with ZAP-CLI, I required a <em>context</em> which basically was a cofiguration written in XML to define how to perform a scan. This context also had a set of credentials in it that were recorded with a <a href="https://github.com/mozilla/zest/wiki">ZEST</a> script, which is a JSON-based form used to record interactions between a website and a user specially created for security tools focused on web applications. This context file along with the ZEST script would allow zap-cli to authenticate with DVNA to be able to scan the portion of the application that lies behind the login screen.</li>
</ul>
<h2 id="temp-stuff">TEMP Stuff</h2>
<p>The stuff listed below here is to be formatted and put into it's required place once the proper segment for the information is identified and written.</p>
<p>Adding jenkins user to the docker group (not recommended as it is equivalent of giving jenkins root access. Preferred way is to have dokcer infra on a separate machine to isolate access from jenkins). Command to add jenkins to docker group:</p>
<pre><code class="bash">sudo usermod -aG docker jenkins
</code></pre>

<p>Zap baseline scan:</p>
<pre><code class="bash">docker run -v /home/chaos/ZAP/:/zap/wrk/:rw --name zapbase -i owasp/zap2docker-stable zap-baseline.py -t http://172.17.0.1:9090 -r baseline_report.html -l INFO
</code></pre>

<ul>
<li>for trouble shooting 'source not found' issue with jenkins shell (<code>sh</code>) pointing to <code>/bin/dash</code> instead of <code>/bin/bash</code> was solved with the help of this <a href="https://www.ionutgavrilut.com/2019/jenkins-pipelines-sh-source-not-found/">article</a>.</li>
</ul>
<p>The following context file is what is needed by the zap-cli to authenticate with the login screen in DVNA.</p>
<pre><code class="zap-context">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;configuration&gt;
    &lt;context&gt;
        &lt;name&gt;Default Context&lt;/name&gt;
        &lt;desc/&gt;
        &lt;inscope&gt;true&lt;/inscope&gt;
        &lt;tech&gt;
            &lt;include&gt;Db&lt;/include&gt;
            &lt;include&gt;Db.CouchDB&lt;/include&gt;
            &lt;include&gt;Db.Firebird&lt;/include&gt;
            &lt;include&gt;Db.HypersonicSQL&lt;/include&gt;
            &lt;include&gt;Db.IBM DB2&lt;/include&gt;
            &lt;include&gt;Db.Microsoft Access&lt;/include&gt;
            &lt;include&gt;Db.Microsoft SQL Server&lt;/include&gt;
            &lt;include&gt;Db.MongoDB&lt;/include&gt;
            &lt;include&gt;Db.MySQL&lt;/include&gt;
            &lt;include&gt;Db.Oracle&lt;/include&gt;
            &lt;include&gt;Db.PostgreSQL&lt;/include&gt;
            &lt;include&gt;Db.SAP MaxDB&lt;/include&gt;
            &lt;include&gt;Db.SQLite&lt;/include&gt;
            &lt;include&gt;Db.Sybase&lt;/include&gt;
            &lt;include&gt;Language&lt;/include&gt;
            &lt;include&gt;Language.ASP&lt;/include&gt;
            &lt;include&gt;Language.C&lt;/include&gt;
            &lt;include&gt;Language.JSP/Servlet&lt;/include&gt;
            &lt;include&gt;Language.Java&lt;/include&gt;
            &lt;include&gt;Language.JavaScript&lt;/include&gt;
            &lt;include&gt;Language.PHP&lt;/include&gt;
            &lt;include&gt;Language.Python&lt;/include&gt;
            &lt;include&gt;Language.Ruby&lt;/include&gt;
            &lt;include&gt;Language.XML&lt;/include&gt;
            &lt;include&gt;OS&lt;/include&gt;
            &lt;include&gt;OS.Linux&lt;/include&gt;
            &lt;include&gt;OS.MacOS&lt;/include&gt;
            &lt;include&gt;OS.Windows&lt;/include&gt;
            &lt;include&gt;SCM&lt;/include&gt;
            &lt;include&gt;SCM.Git&lt;/include&gt;
            &lt;include&gt;SCM.SVN&lt;/include&gt;
            &lt;include&gt;WS&lt;/include&gt;
            &lt;include&gt;WS.Apache&lt;/include&gt;
            &lt;include&gt;WS.IIS&lt;/include&gt;
            &lt;include&gt;WS.Tomcat&lt;/include&gt;
        &lt;/tech&gt;
        &lt;urlparser&gt;
            &lt;class&gt;org.zaproxy.zap.model.StandardParameterParser&lt;/class&gt;
            &lt;config&gt;{&quot;kvps&quot;:&quot;&amp;amp;&quot;,&quot;kvs&quot;:&quot;=&quot;,&quot;struct&quot;:[]}&lt;/config&gt;
        &lt;/urlparser&gt;
        &lt;postparser&gt;
            &lt;class&gt;org.zaproxy.zap.model.StandardParameterParser&lt;/class&gt;
            &lt;config&gt;{&quot;kvps&quot;:&quot;&amp;amp;&quot;,&quot;kvs&quot;:&quot;=&quot;,&quot;struct&quot;:[]}&lt;/config&gt;
        &lt;/postparser&gt;
        &lt;authentication&gt;
            &lt;type&gt;4&lt;/type&gt;
            &lt;loggedin&gt;Logout&lt;/loggedin&gt;
            &lt;loggedout&gt;Login&lt;/loggedout&gt;
            &lt;script&gt;
                &lt;name&gt;Authenticating with Login Form in DVNA&lt;/name&gt;
                &lt;params&gt;cGFzc3dvcmQ=:YWRtaW4=&amp;amp;dXNlcm5hbWU=:YWRtaW4=&lt;/params&gt;
            &lt;/script&gt;
        &lt;/authentication&gt;
        &lt;users&gt;
            &lt;user&gt;57;false;VXNlciAx;4;&lt;/user&gt;
        &lt;/users&gt;
        &lt;forceduser&gt;57&lt;/forceduser&gt;
        &lt;session&gt;
            &lt;type&gt;0&lt;/type&gt;
        &lt;/session&gt;
        &lt;authorization&gt;
            &lt;type&gt;0&lt;/type&gt;
            &lt;basic&gt;
                &lt;header/&gt;
                &lt;body/&gt;
                &lt;logic&gt;AND&lt;/logic&gt;
                &lt;code&gt;-1&lt;/code&gt;
            &lt;/basic&gt;
        &lt;/authorization&gt;
    &lt;/context&gt;
&lt;/configuration&gt;
</code></pre>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../deploying_report/" title="Deploying the Report" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Deploying the Report
              </span>
            </div>
          </a>
        
        
          <a href="../code_lint_analysis/" title="Linting Analysis" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Linting Analysis
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>