



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Static Analysis - Jenkins Pipeline</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#static-analysis" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Jenkins Pipeline" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Jenkins Pipeline
            </span>
            <span class="md-header-nav__topic">
              
                Static Analysis
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Jenkins Pipeline" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Jenkins Pipeline
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../problem_statement/" title="Problem Statement" class="md-nav__link">
      Problem Statement
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../setting_up_vms/" title="Setting Up VMs" class="md-nav__link">
      Setting Up VMs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../setting_up_pipeline/" title="Setting Up Pipeline" class="md-nav__link">
      Setting Up Pipeline
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Static Analysis
      </label>
    
    <a href="./" title="Static Analysis" class="md-nav__link md-nav__link--active">
      Static Analysis
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objective" class="md-nav__link">
    Objective
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sast" class="md-nav__link">
    SAST
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dvnas-tech-stack" class="md-nav__link">
    DVNA's Tech Stack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sast-tools-for-nodejs-applications" class="md-nav__link">
    SAST Tools for Node.js Applications
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sonarqube" class="md-nav__link">
    SonarQube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npm-audit" class="md-nav__link">
    NPM Audit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nodejsscan" class="md-nav__link">
    NodeJsScan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retirejs" class="md-nav__link">
    Retire.js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#owasp-dependency-check" class="md-nav__link">
    OWASP Dependency Check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auditjs" class="md-nav__link">
    Auditjs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snyk" class="md-nav__link">
    Snyk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sast-analysis-reports" class="md-nav__link">
    SAST Analysis Reports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-tools" class="md-nav__link">
    Other Tools
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../comparing_sast_tools/" title="Comparing SAST Tools" class="md-nav__link">
      Comparing SAST Tools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../configuring_webhook/" title="Configuring Webhook" class="md-nav__link">
      Configuring Webhook
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../deploying_report/" title="Deploying the Report" class="md-nav__link">
      Deploying the Report
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../dynamic_analysis/" title="Dynamic Analysis" class="md-nav__link">
      Dynamic Analysis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../code_quality_analysis/" title="Code Quality Analysis" class="md-nav__link">
      Code Quality Analysis
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../generating_sbom/" title="Generating Software Bill of Materials" class="md-nav__link">
      Generating Software Bill of Materials
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../resources/" title="Resources" class="md-nav__link">
      Resources
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#objective" class="md-nav__link">
    Objective
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sast" class="md-nav__link">
    SAST
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dvnas-tech-stack" class="md-nav__link">
    DVNA's Tech Stack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sast-tools-for-nodejs-applications" class="md-nav__link">
    SAST Tools for Node.js Applications
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sonarqube" class="md-nav__link">
    SonarQube
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#npm-audit" class="md-nav__link">
    NPM Audit
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nodejsscan" class="md-nav__link">
    NodeJsScan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#retirejs" class="md-nav__link">
    Retire.js
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#owasp-dependency-check" class="md-nav__link">
    OWASP Dependency Check
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#auditjs" class="md-nav__link">
    Auditjs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snyk" class="md-nav__link">
    Snyk
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#sast-analysis-reports" class="md-nav__link">
    SAST Analysis Reports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#other-tools" class="md-nav__link">
    Other Tools
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="static-analysis">Static Analysis</h1>
<h2 id="objective">Objective</h2>
<p>The aim of this section is to understand the tech stack used for the project (DVNA), identify suitable tools to perform SAST and generate a report to provide a solution to the 2nd, 3rd and 4th points of the <a href="../problem_statement/">problem statement</a> under <code>Task 1</code>.</p>
<h2 id="sast">SAST</h2>
<p>SAST or Static Application Security Testing is a process that analyses a project's source code, dependencies and related files for known security vulnerabilities. SAST could also help identify segments of the project's logic which might lead to a security vulnerability.</p>
<h2 id="dvnas-tech-stack">DVNA's Tech Stack</h2>
<p>SAST is a targeted analysis configured based on the technologies being used in a project. Hence, for any meaningful SAST stage in a pipeline (or in general), the tools utilized should be concerned only with the technologies that the project uses. If need be, one could use multiple tools (as one should, in most cases) to cover different types of vulnerabilities and/or technologies present in the project.</p>
<p>To perform static analysis on DVNA, the first step for me was to identify what all technologies comprise DVNA (which is quite obvious given the name is Damn Vulnerable NodeJs Application). So, I figured that NodeJs is the server-side language used, along with a SQL database.</p>
<h2 id="sast-tools-for-nodejs-applications">SAST Tools for Node.js Applications</h2>
<p>After figuring out the tech stack used, I focused on finding tools that perform static analysis specifically for Nodejs applications. The following are some tools that I found to perform SAST on Nodejs applications with steps to install it and configure them with Jenkins:</p>
<h3 id="sonarqube"><a href="https://www.sonarqube.org/">SonarQube</a></h3>
<p>SonarQube is a commercial static analysis tool with a community version with restricted features. I used this <a href="https://medium.com/@rosaniline/setup-sonarqube-with-jenkins-declarative-pipeline-75bccdc9075f">Medium article</a> to utilize SonarQube with Jenkins and Docker:</p>
<ul>
<li>To start the SonarQube server for analysis I used SonarQube's docker image, as it seemed more convenient than an installed setup unlike all the other tools I used which had a very simple installation procedure, and ran it with the following command:</li>
</ul>
<pre><code class="bash">docker run -d -p 9000:9000 -p 9092:9092 --name sonarqube sonarqube
</code></pre>

<ul>
<li>Then for Jenkins to authenticate with the SonarQube server I created a new Access Token for Jenkins in SonarQube under <code>Account &gt; Security</code>.</li>
<li>I saved the above generated token in Jenkins, under <code>Credentials &gt;  Add New Credentials</code> as a <code>Secret Text</code> type credential so I could use it later with the credential identity created.</li>
<li>I added the SonarQube plugin for Jenkins and then navigated to the <code>SonarQube Server</code> section under <code>Manage Jenkins &gt; Configure System</code>. Here, I checked the <code>Enable injection of SonarQube server configuration as build environment variables</code> option to allow SonarQube to inject environment variables at the pipeline's runtime and be used in the Jenkinsfile.</li>
<li>I provided the URL for SonarQube Server (in my case) <code>localhost:9000</code> and added the previously saved SonarQube Credentials for authentication.</li>
<li>Lastly, I added the following stage in the Jenkinsfile for DVNA's analysis by SonarQube, which injects the path to the SonarQube scanner, performs the scan and then saves the report locally:</li>
</ul>
<pre><code class="jenkins">stage ('SonarQube Analysis') {
    environment {
        scannerHome = tool 'SonarQube Scanner'
    }

    steps {
        withSonarQubeEnv ('SonarQube') {
            sh '${scannerHome}/bin/sonar-scanner'
            sh 'cat .scannerwork/report-task.txt &gt; /{JENKINS HOME DIRECTORY}/reports/sonarqube-report'
        }
    }
}
</code></pre>

<p><strong>Note</strong>: There are two segments where I drifted away from the article I referred to:</p>
<ul>
<li>First is that in the article there is no mention of generating/storing a report.</li>
<li>Secondly, I left out the <code>timeout</code> block in the pipeline stage given in the article.</li>
</ul>
<h3 id="npm-audit"><a href="https://docs.npmjs.com/cli/audit">NPM Audit</a></h3>
<p>NPM Audit is a built-in utility that comes along with <code>npm@6</code> which allows for <em>auditing</em> the dependencies being used in the project i.e. it analyses the dependencies against a database for known vulnerabilities. Since NPM Audit comes along with <code>npm</code> itself, is not required to be installed separately. However, if one has an older version of <code>npm</code> on the system, the following command can be used to upgrade:</p>
<pre><code class="bash">sudo npm install -g npm@latest
</code></pre>

<ul>
<li>Now, NPM Audit has a characteristic that gives a non-zero status code, if it finds any vulnerable dependencies. This is so if run through a pipeline, the build can fail thus, stopping the deployment of vulnerable code. Since, DVNA, quite obviously, has a lot of vulnerabilities, I had to run it through a script to avoid failure of the pipeline after analysis so the stages can still be executed. The script that I wrote, which runs <code>npm-audit</code>, formats the output in a JSON format, saves it to a file and finally just echoes the status code, is as follows:</li>
</ul>
<pre><code class="bash">#!/bin/bash

cd /{JENKINS HOME DIRECTORY}/workspace/node-app-pipeline
npm audit --json &gt; /{JENKINS HOME DIRECTORY}/reports/npm-audit-report

echo $? &gt; /dev/null
</code></pre>

<ul>
<li>Lastly, I added the following stage in the Jenkinsfile to execute the script I wrote:</li>
</ul>
<pre><code class="jenkins">stage ('NPM Audit Analysis') {
    steps {
        sh '/{PATH TO SCRIPT}/npm-audit.sh'
    }
}
</code></pre>

<h3 id="nodejsscan"><a href="https://github.com/ajinabraham/NodeJsScan">NodeJsScan</a></h3>
<p>NodeJsScan is a static security code scanner for NodeJs applications written in python. It comes with a web-based interface, docker image, Python API as well as a CLI.</p>
<ul>
<li>Unlike SonarQube, installing NodeJsScan was just a single command so I went ahead and installed it. To install <code>NodeJsScan</code>, I used the following command:</li>
</ul>
<pre><code class="bash">pip3 install nodejsscan
</code></pre>

<p><strong>Note</strong>: I noticed that the package was not available to all users, even though I installed it globally. So, to rectify this issue, I ran the following command: <code>sudo -H pip3 install nodejsscan</code>.</p>
<ul>
<li>Once NodeJsScan was installed, I ran the below command (taken from the <a href="https://github.com/ajinabraham/NodeJsScan">official documentation</a>) to test the tool and observe its operation before I added it to the pipeline script:</li>
</ul>
<pre><code class="bash">nodejsscan --directory `pwd` --output /{JENKINS HOME DIRECTORY}/reports/nodejsscan-report
</code></pre>

<ul>
<li>After observing that NodeJsScan did not exit with a non-zero status code, even if vulnerabilities were found, I realized that the command to execute the scan can be directly added to the pipeline. So, I added the following stage in the Jenkinsfile to perform the scan, and store the report in JSON format on the Jenkins machine:</li>
</ul>
<pre><code class="jenkins">stage ('NodeJsScan Analysis') {
    steps {
        sh 'nodejsscan --directory `pwd` --output /{JENKINS HOME DIRECTORY}/reports/nodejsscan-report'
    }
}
</code></pre>

<h3 id="retirejs"><a href="https://retirejs.github.io/retire.js/">Retire.js</a></h3>
<p>Retire.js is a tool that scans the project's dependencies to identify dependencies with versions that have known vulnerabilities. It comes as a plugin for various applications and as a CLI.</p>
<ul>
<li>Retire.js was also available to be installed as a package without too much hassle, so I installed it with the following command:</li>
</ul>
<pre><code class="bash">sudo npm install -g retire
</code></pre>

<p><strong>Note</strong>: The <code>-g</code> flag specifies that the package needs to be installed globally.</p>
<ul>
<li>Then to look at how Retire.js functions, I ran it with the following command as mentioned in the <a href="https://github.com/RetireJS/retire.js">official documentation</a> to run the scan on DVNA, output the report in JSON format, save it locally on a file and then exit with a zero status-code even if vulnerabilities are found:</li>
</ul>
<pre><code class="bash">retire --path `pwd` --outputformat json --outputpath /{JENKINS HOME DIRECTORY}/reports/retirejs-report --exitwith 0
</code></pre>

<ul>
<li>After observing the output and since, I had the ability to alter the status code the program gave on exit, I used the command directly and added the following stage in the Jenkinsfile:</li>
</ul>
<pre><code class="jenkins">stage ('Retire.js Analysis') {
    steps {
        sh 'retire --path `pwd` --outputformat json --outputpath /{JENKINS HOME DIRECTORY}/reports/retirejs-report --exitwith 0'
    }
}
</code></pre>

<h3 id="owasp-dependency-check"><a href="https://www.owasp.org/index.php/OWASP_Dependency_Check">OWASP Dependency Check</a></h3>
<p>As mentioned on OWASP Dependency Check's official site, it is a software composition analysis tool, used to identify if the project has any known security vulnerabilities as part of its dependencies.</p>
<ul>
<li>
<p>OWASP Dependency Check comes as an executable for Linux and does not require any installation, so I decided to use the binary. I downloaded the executable from this <a href="https://dl.bintray.com/jeremy-long/owasp/dependency-check-5.2.4-release.zip">archive</a>.</p>
</li>
<li>
<p>Next, I unzipped the archive and then placed its contents in <code>/{JENKINS HOME DIRECTORY}/</code>:</p>
</li>
</ul>
<pre><code class="bash">unzip dependency-check-5.2.4-release.zip
</code></pre>

<ul>
<li>As written in the <a href="https://jeremylong.github.io/DependencyCheck/dependency-check-cli/index.html">official documentation</a>, I ran the following command to start the scan with the executable and save the output to a file in JSON format:</li>
</ul>
<pre><code class="bash">/{JENKINS HOME DIRECTORY}/dependency-check/bin/dependency-check.sh --scan /{JENKINS HOME DIRECTORY}/workspace/node-app-pipeline --format JSON --out /{JENKINS HOME DIRECTORY}/reports/dependency-check-report --prettyPrint
</code></pre>

<ul>
<li>Since, Dependency-Check doesn't change the status code to a non-zero one, I added the command directly as a stage in the Jenkinfile:</li>
</ul>
<pre><code class="jenkins">stage ('Dependency-Check Analysis') {
    steps {
        sh '/{JENKINS HOME DIRECTORY}/dependency-check/bin/dependency-check.sh --scan `pwd` --format JSON --out /{JENKINS HOME DIRECTORY}/reports/dependency-check-report --prettyPrint'
    }
}
</code></pre>

<p><strong>Note</strong>: By using OWASP's Dependency Check, I happened to introduce a redundant use of a few tools, namely Retire.js and NPM Audit, as they are already a part of Dependency Check's scan methodology.</p>
<h3 id="auditjs"><a href="https://github.com/sonatype-nexus-community/auditjs">Auditjs</a></h3>
<p>Auditjs is a SAST tool which uses <a href="https://ossindex.sonatype.org/">OSS Index</a>, which is a service used to determine if a dependency being used has a known vulnerability, to analyze NodeJs applications.</p>
<ul>
<li>Like Retire.js, Auditjs is also available as an npm-package. So, I installed it with the following command:</li>
</ul>
<pre><code class="bash">sudo npm install -g auditjs
</code></pre>

<ul>
<li>Next, I ran a scan to observe the output provided by Auditjs by running the following command, as mentioned in the <a href="https://github.com/sonatype-nexus-community/auditjs">documentation</a>, while being inside the project directory:</li>
</ul>
<pre><code class="bash">auditjs --username ayushpriya10@gmail.com --token &lt;auth_token&gt; /{JENKINS HOME DIRECTORY}/reports/auditjs-report 2&gt;&amp;1
</code></pre>

<p><strong>Note</strong>: As it appears, Auditjs prints the vulnerabilities found to STDERR and everything else to STDOUT. Hence, I couldn't write the vulnerabilities found to a file directly. So, I used <code>2&gt;&amp;1</code> to redirect STDERR output to STDOUT to be able to write everything to a file.</p>
<ul>
<li>Like some previous tools, Auditjs gives a non-zero status code, if it finds any vulnerable dependencies, hence, I ran it through a script to avoid build failures with the pipeline. I wrote a script to overcome this issue, as done previously as well, to run the scan and save the report locally. The contents of the script I wrote are as follows:</li>
</ul>
<pre><code class="bash">#!/bin/bash

cd /{JENKINS HOME DIRECTORY}/workspace/node-app-pipeline
auditjs --username ayushpriya10@gmail.com --token &lt;auth_token&gt; /{JENKINS HOME DIRECTORY}/reports/auditjs-report 2&gt;&amp;1

echo $? &gt; /dev/null
</code></pre>

<ul>
<li>Lastly, I added the following stage to the Jenkinsfile to execute the script I wrote:</li>
</ul>
<pre><code class="jenkins">stage ('Audit.js Analysis') {
    steps {
        sh '/{PATH TO SCRIPT}/auditjs.sh'
    }
}
</code></pre>

<h3 id="snyk"><a href="https://github.com/snyk/snyk#cli">Snyk</a></h3>
<p>Snyk is a platform that helps monitor (open source) projects present on GitHub, Bitbucket, etc. or locally to identify dependencies with known vulnerabilities. It is available as a CLI and as a docker image.</p>
<ul>
<li>Snyk can be installed with <code>npm</code> so, I used the following command to do so:</li>
</ul>
<pre><code class="bash">sudo npm install -g snyk
</code></pre>

<ul>
<li>Snyk required that I authenticated Snyk CLI with an Authentication Token, that can be found on one's profile after signing up for Snyk, before scanning a project, which I did as follows:</li>
</ul>
<pre><code class="bash">snyk auth &lt;AUTH TOKEN&gt;
</code></pre>

<ul>
<li>Then to perform a scan I ran the following command as mentioned in the <a href="https://github.com/snyk/snyk#cli">official documentation</a>:</li>
</ul>
<pre><code class="bash">snyk test
</code></pre>

<ul>
<li>Snyk also gives a non-zero status code, if it finds any vulnerable dependencies, hence, I ran it through a script, which performs a scan and stores the report in a JSON format, to avoid build-failure with the pipeline. The contents of the script I wrote are as follows:</li>
</ul>
<pre><code class="bash">#!/bin/bash

cd /{JENKINS HOME DIRECTORY}/workspace/node-app-pipeline
snyk auth &lt;auth_token&gt;
snyk test --json &gt; /{JENKINS HOME DIRECTORY}/reports/snyk-report

echo $? &gt; /dev/null
</code></pre>

<ul>
<li>Finally, I added a stage to the pipeline which executes the script:</li>
</ul>
<pre><code class="jenkins">stage ('Snyk Analysis') {
    steps {
        sh '/{PATH TO SCRIPT}/snyk.sh'
    }
}
</code></pre>

<h2 id="sast-analysis-reports">SAST Analysis Reports</h2>
<p>I stored the reports generated by the various tools in <code>/reports/</code> directory inside Jenkins' home directory. Most of these reports were in JSON format, except for SonarQube and Auditjs. SonarQube's report was available on in the web interface and Auditjs' report was normal textual output being printed to console or, in my case, being redirected to a file.</p>
<h2 id="other-tools">Other Tools</h2>
<p>There were a few other tools available to perform SAST on NodeJs applications. They are listed below along with the reason why I chose not to use them for this task:</p>
<ul>
<li>
<p><a href="https://github.com/nodesecurity/nsp">NSP</a><br />
According to what NSP's (Node Security Project) official site said, it is now replaced with <code>npm audit</code> starting npm@6 and hence, is unavailable to new users but without any loss as it's functionality is available with NPM Audit.</p>
</li>
<li>
<p><a href="https://github.com/dpnishant/jsprime">JSPrime</a><br />
JSPrime appeared to be a really nice tool from its documentation and a demonstration video from a talk in a security conference, but it lacked a CLI interface and hence, I couldn't integrate it into the CI Pipeline.</p>
</li>
<li>
<p><a href="https://github.com/mozilla/scanjs">ScanJS</a><br />
As stated by the official site, ScanJS is now deprecated and was throwing an exception when I tried running an available version via the CLI interface. So, I ended up excluding it from my implementation for the task.</p>
</li>
<li>
<p><a href="https://github.com/dvolvox/JSpwn">JSpwn</a> (JSPrime + ScanJs)<br />
JSpwn is a SAST tool that combined both JSPrime and ScanJs and had a CLI interface as well but when I executed it in accordance with the official documentation, the CLI gave garbage output without throwing any error and ran without ever terminating. Hence, I chose not to use it in my solution for the task.</p>
</li>
</ul>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../setting_up_pipeline/" title="Setting Up Pipeline" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Setting Up Pipeline
              </span>
            </div>
          </a>
        
        
          <a href="../comparing_sast_tools/" title="Comparing SAST Tools" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Comparing SAST Tools
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>